<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Configuration</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
  <meta name="format-detection" content="telephone=no">

  <link rel="shortcut icon" href="assets/favicon_block.png"  />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Roboto+Mono:300,400,700" rel="stylesheet">
  <link href="./assets/vendor/css/fontawesome-all.min.css" rel="stylesheet">
  <!--<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->

  <style>

    body {
      background-color: #0e2742;
      font-family: "Open Sans", sans-serif;
      margin-left: 0;
      margin-right: 0;
      margin-top: 0;
      margin-bottom: 0;
    }
    h1, h2, h3, h4 {
      color: #fff;
      margin-top: 0;
      margin-bottom: 0;
      padding: 10px 15px;
      background-color: #172e48;
      letter-spacing: 1px;
    }
    .container {
      padding: 20px;
      padding-bottom: 10px;
    }
    .input-group {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: flex-start;
      margin-bottom: 15px;
    }
    .input-group label {
      width: 35%;
      background-color: #213d54;
      color: #fff;
      padding: 15px 15px;
      font-weight: 300;
      /*font-size: 14px;*/
    }
    .input-group input {
      flex-grow: 1;
      background-color: #123149;
      color: #fff;
      padding: 15px 20px;
      font-weight: 300;
      /*font-size: 14px;*/
      border-width: 1px;
      border-color: #123149;
      border-style: solid;
      outline-width: 0;
    }
    .input-group input:focus {
      outline-width: 0;
      border-width: 1px;
      border-color: #4b6275;
      border-style: solid;
    }
    .dropdown-button {
      position: relative;
      opacity: 1;
      flex-grow: 1;
      background-color: #123149;
      color: #fff;
      padding: 15px 20px;
      font-weight: 300;
      /*font-size: 14px;*/
      border-width: 1px;
      border-color: #123149;
      border-style: solid;
      outline-width: 0;
      cursor: pointer;
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: space-between;
    }
    .dropdown-button:hover {
      background-color: rgba(18, 49, 73, .8);
    }
    input {
      flex-grow: 1;
      background-color: #123149;
      color: #fff;
      padding: 15px 20px;
      font-weight: 300;
      font-size: 14px;
      border-width: 1px;
      border-color: #123149;
      border-style: solid;
      outline-width: 0;
    }
    input:focus {
      outline-width: 0;
      border-width: 1px;
      border-color: #4b6275;
      border-style: solid;
    }
    button {
      display: block;
      flex-grow: 1;
      flex-basis: 0;
      /*flex-basis: 1;*/
      /*width: 100%;*/
      margin: 10px;
      margin-bottom: 0;
      background-color: #0069ff;
      color: #fff;
      padding: 15px 20px;
      font-size: 14px;
      border-top-width: 0;
      border-bottom-width: 0;
      border-left-width: 0;
      border-right-width: 0;
      outline-width: 0;
      cursor: pointer;
      transition: background-color .5s;
    }
    button:hover {
      background-color: #0054cc;
    }
    button:active {
      outline-width: 0;
    }
    button:disabled {
      background-color: #0054cc;
      opacity: .8;
      cursor: default;
    }
    button.gray-button {
      background-color: #ddd;
      color: #0069ff;
      opacity: 1;
      transition: opacity .5s;
    }
    button.gray-button:hover {
      opacity: .7;
    }
    div.button-container {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: flex-start;
      margin-top: 10px;
      height: 56px;
      min-height: 56px;
      margin-left: -10px;
      margin-right: -10px;
    }
    .flex-container {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: flex-start;
    }
    .col1 {
      width: 300px;
      min-width: 300px;
      height: 465px;
      margin-top: 0;
      margin-bottom: 0;
      margin-left: 0;
      margin-right: 10px;
      padding-left: 20px;
      padding-right: 20px;
      padding-top: 10px;
      background-color: #172e48;
    }
    .col2 {
      flex-grow: 1;
      margin-left: 10px;
      height: 475px;
      max-height: 475px;
      color: #fff;
      display: flex;
      flex-direction: column;
    }
    .sidebar-item {
      margin-top: 10px;
      margin-bottom: 10px;
      color: #fff;
      cursor: default;
      /*cursor: pointer;*/
    }
    .sidebar-item:hover {
      /*opacity: .8;*/
    }
    .radio-icon {
      color: #339CFF;
      margin-right: 10px;
    }
    .main-area {
      flex-grow: 1;
      background-color: #243b55;
      padding: 10px;
      overflow-x: hidden;
      overflow-y: scroll;
    }
    .main-area-item {
      padding: 10px;
      cursor: pointer;
    }
    .main-area-item:hover {
      opacity: .8;
    }
    .main-area-item2 {
      background-color: #0e2742;
      margin: 10px;
      padding: 20px;
    }
    .text-danger {
      color: #ed1c24;
    }
    ::-webkit-scrollbar {
      width: 6px;
      border: 0;
    }

    ::-webkit-scrollbar-track {
      -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
    }

    ::-webkit-scrollbar-thumb {
      background-color: rgba(248, 248, 248, 0.5);
      border: 0;
      border-radius: 3px;
    }

  </style>

</head>
<body>
<div style="width:100%; padding: 20px 0 20px 0; text-align:center;"><img style="max-width:300px;" src="assets/logo_full.svg" alt="Blocknet Logo"></div>

<div id="js-main"></div>

  <script type="text/javascript">
    window.electron = require('electron');
  </script>

  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

  <script type="text/javascript" src="assets/vendor/jquery.min.js"></script>

  <script>if (window.module) module = window.module;</script>

  <script type="text/javascript">

    const fs = require('fs');
    const { dialog } = require('electron').remote;
    const { Set } = require('immutable');

    const sortByVersion = arr => [...arr]
      .sort((a, b) => {
        const splitA = a.split('.');
        const splitB = b.split('.');
        for(let i = 0; i < 3; i++) {
          splitA[i] = Number(splitA[i]) || 0;
          splitB[i] = Number(splitB[i]) || 0;
        }
        if(splitA[0] === splitB[0]) {
          if(splitA[1] === splitB[1]) {
            if(splitA[2] === splitB[2]) {
              return 0;
            } else {
              return splitA[2] > splitB[2] ? 1 : -1;
            }
          } else {
            return splitA[1] > splitB[1] ? 1 : -1;
          }
        } else {
          return splitA[0] > splitB[0] ? 1 : -1;
        }
      });

    $(document).ready(() => {

      const state = {

        _data: new Map(),

        set(key, val) {
          this._data.set(key, val);
          console.log('state', [...this._data.entries()]
            .reduce((obj, [ key, val ]) => Object.assign(obj, {[key]: val}), {})
          );
        },

        get(key) {
          return this._data.get(key);
        }

      };

      state.set('sidebarSelected', 0);
      state.set('sidebarItems', [
        {text: 'Configuration Setup'},
        {text: 'RPC Settings'}
      ]);
      state.set('selectedWallets', Set(['BLOCK']));

      const versions = ['0.1.1', '0.1.2', '0.1.3', '0.1.4'];
      const latest = versions[versions.length -1];
      state.set('wallets', [
        {name: 'Blocknet', abbr: 'BLOCK', directory: '', error: false, username: '', password: '', version: latest, versions},
        {name: 'Bitcoin', abbr: 'BTC', directory: '', error: false, username: '', password: '', version: latest, versions},
        {name: 'Mona', abbr: 'MONA', directory: '', error: false, username: '', password: '', version: latest, versions},
        {name: 'Sys', abbr: 'SYS', directory: '', error: false, username: '', password: '', version: latest, versions},
      ]);
      state.set('skipSetup', false);
      state.set('active', 'configuration1');
      state.set('generateCredentials', true);
      state.set('rpcPort', '41414');
      state.set('rpcUser', '');
      state.set('rpcPassword', '');

      const render = () => {

        const sidebarSelected = state.get('sidebarSelected');
        const wallets = state.get('wallets');
        const selectedWallets = state.get('selectedWallets');
        const filteredWallets = wallets
          .filter(w => selectedWallets.has(w.abbr))
          .map(w => {
            if(!w.directory) return w;
            try {
              fs.statSync(w.directory);
              w.error = false;
              return w;
            } catch(err) {
              console.error(err);
              w.error = true;
              return w;
            }
          });

        const active = state.get('active');
        const sidebarHTML = renderSidebar();
        let mainHTML;
        switch(active) {
          case 'configuration1':
            mainHTML = renderConfiguration1();
            break;
          case 'configuration2':
            mainHTML = renderConfiguration2({ wallets: filteredWallets });
            break;
          case 'configuration3':
            mainHTML = renderConfiguration3({ wallets: filteredWallets });
            break;
          case 'settings1':
            mainHTML = renderSettings1();
            break;
          case 'settings2':
            mainHTML = renderSettings2({ wallets: filteredWallets });
            break;
          case 'settings3':
            mainHTML = renderSettings3();
            break;
          case 'complete':
            mainHTML = renderComplete();
            break;
          default:
            mainHTML = '';
        }

        const html = `
          <h3>${active === 'complete' ? 'SETUP COMPLETE' : sidebarSelected === 0 ? 'CONFIGURATION SETUP' : 'RPC SETTINGS'}</h3>
          <div class="container">
            <div class="flex-container">
              <div class="col1">
                ${sidebarHTML}
              </div>
              <div class="col2">
                ${mainHTML}
              </div>
            </div>
          </div>
        `;

        $('#js-main').html(html);
        setTimeout(() => {

          $('.js-mainAreaItem')
            .off('click')
            .on('click', e => {
              e.preventDefault();
              const abbr = $(e.currentTarget).attr('data-abbr');
              const $target = $(e.currentTarget).find('i');
              const selectedWallets = state.get('selectedWallets');
              if($target.hasClass('fa-check-square')) { // it is checked
                $target.addClass('fa-square');
                $target.removeClass('fa-check-square');
                state.set('selectedWallets', selectedWallets.delete(abbr));
              } else { // it is not checked
                $target.addClass('fa-check-square');
                $target.removeClass('fa-square');
                state.set('selectedWallets', selectedWallets.add(abbr));
              }

            });

          $('#js-skip')
            .off('click')
            .on('click', e => {
              e.preventDefault();
              const skip = state.get('skipSetup');
              const $main = $('#js-mainConfigurationArea');
              const $overlay = $('#js-overlay');
              const $target = $(e.currentTarget).find('i');
              if(skip) { // it is checked
                $target.addClass('fa-square');
                $target.removeClass('fa-check-square');
                $main.css('overflow-y', 'scroll');
                $main.css('opacity', '1');
                state.set('skipSetup', false);
                $overlay.css('display', 'none');
              } else { // it is not checked
                $target.addClass('fa-check-square');
                $target.removeClass('fa-square');
                $main.css('opacity', '.6');
                $main.css('overflow-y', 'hidden');
                state.set('skipSetup', true);
                $overlay.css('display', 'block');
              }
            });

          $('#js-continueBtn')
            .off('click')
            .on('click', e => {
              e.preventDefault();
              const generateCredentials = state.get('generateCredentials');
              const skipSetup = state.get('skipSetup');
              switch(active) {
                case 'configuration1':
                  if(skipSetup) {
                    state.set('active', 'settings3');
                    state.set('sidebarSelected', 1);
                  } else {
                    state.set('active', 'configuration2');
                    state.set('sidebarSelected', 0);
                  }
                  break;
                case 'configuration2':
                  state.set('active', 'configuration3');
                  state.set('sidebarSelected', 0);
                  break;
                case 'configuration3':
                  state.set('active', 'settings1');
                  state.set('sidebarSelected', 1);
                  break;
                case 'settings1':
                  if(generateCredentials) {
                    state.set('active', 'complete');
                    state.set('sidebarSelected', 1);
                  } else {
                    state.set('active', 'settings2');
                    state.set('sidebarSelected', 1);
                  }
                  break;
                case 'settings2':
                  state.set('active', 'settings3');
                  state.set('sidebarSelected', 1);
                  break;
                case 'settings3':
                  state.set('active', 'complete');
                  state.set('sidebarSelected', 1);
                  break;
              }
              render();
            });

          $('#js-backBtn')
            .off('click')
            .on('click', e => {
              e.preventDefault();
              const generateCredentials = state.get('generateCredentials');
              const skipSetup = state.get('skipSetup');
              switch(active) {
                case 'configuration2':
                  state.set('active', 'configuration1');
                  state.set('sidebarSelected', 0);
                  break;
                case 'configuration3':
                  state.set('active', 'configuration2');
                  state.set('sidebarSelected', 0);
                  break;
                case 'settings1':
                  state.set('active', 'configuration3');
                  state.set('sidebarSelected', 0);
                  break;
                case 'settings2':
                  state.set('active', 'settings1');
                  state.set('sidebarSelected', 1);
                  break;
                case 'settings3':
                  if(skipSetup) {
                    state.set('active', 'configuration1');
                    state.set('sidebarSelected', 0);
                  } else {
                    state.set('active', 'settings2');
                    state.set('sidebarSelected', 1);
                  }
                  break;
                case 'complete':
                  if(!skipSetup && generateCredentials) {
                    state.set('active', 'settings1');
                    state.set('sidebarSelected', 1);
                  } else {
                    state.set('active', 'settings3');
                    state.set('sidebarSelected', 1);
                  }
                  break;
              }
              render();
            });

          $('.js-browseBtn')
            .off('click')
            .on('click', e => {
              e.preventDefault();
              const abbr = $(e.currentTarget).attr('data-abbr');
              dialog.showOpenDialog({
                title: `${abbr} Data Directory`,
                properties: ['openDirectory']
              }, ([ directoryPath ]) => {
                if(directoryPath) {
                  $(`#${abbr}`).val(directoryPath);
                  $(`#${abbr}-error`).css('display', 'none');
                  const wallets = state.get('wallets');
                  const idx = wallets.findIndex(w => w.abbr === abbr);
                  const newWallets = [
                    ...wallets.slice(0, idx),
                    Object.assign({}, wallets[idx], {directory:directoryPath, error: false}),
                    ...wallets.slice(idx + 1)
                  ];
                  state.set('wallets', newWallets);
                  const selectedWallets = state.get('selectedWallets');
                  const filteredWallets = newWallets
                    .filter(w => selectedWallets.has(w.abbr));
                  const errorCount = filteredWallets.reduce((num, w) => (!w.error && w.directory) ? num : num + 1, 0);
                  if(errorCount === 0) {
                    $('#js-errors').css('display', 'none');
                  } else {
                    $('#js-errorCount').text(errorCount);
                    $('#js-errors').css('display', 'block');
                  }
                }
              })
            });
          const toggleCredentialGeneration = e => {
            e.preventDefault();
            const generateCredentials = state.get('generateCredentials');
            state.set('generateCredentials', !generateCredentials);
            const $automatic = $('#js-automaticCredentials').find('i');
            const $manual = $('#js-manualCredentials').find('i');
            if(generateCredentials) {
              $automatic.addClass('far');
              $automatic.removeClass('fa');
              $manual.addClass('fa');
              $manual.removeClass('far');
            } else {
              $automatic.addClass('fa');
              $automatic.removeClass('far');
              $manual.addClass('far');
              $manual.removeClass('fa');
            }
          };
          $('#js-automaticCredentials')
            .off('click')
            .on('click', toggleCredentialGeneration);
          $('#js-manualCredentials')
            .off('click')
            .on('click', toggleCredentialGeneration);
          $('.js-usernameInput')
            .off('change')
            .on('change', e => {
              const wallets = state.get('wallets');
              const { value } = e.target;
              const abbr = $(e.target).attr('data-abbr');
              const idx = wallets.findIndex(w => w.abbr === abbr);
              const newWallets = [
                ...wallets.slice(0, idx),
                Object.assign({}, wallets[idx], {
                  username: value.trim()
                }),
                ...wallets.slice(idx + 1)
              ];
              state.set('wallets', newWallets);
            });
          $('.js-passwordInput')
            .off('change')
            .on('change', e => {
              const wallets = state.get('wallets');
              const { value } = e.target;
              const abbr = $(e.target).attr('data-abbr');
              const idx = wallets.findIndex(w => w.abbr === abbr);
              const newWallets = [
                ...wallets.slice(0, idx),
                Object.assign({}, wallets[idx], {
                  password: value
                }),
                ...wallets.slice(idx + 1)
              ];
              state.set('wallets', newWallets);
            });
          $('#js-rpcPort')
            .off('change')
            .on('change', e => {
              const value = e.target.value.trim();
              state.set('rpcPort', value);
            });
          $('#js-rpcUser')
            .off('change')
            .on('change', e => {
              const wallets = state.get('wallets');
              const { value } = e.target;
              const idx = wallets.findIndex(w => w.abbr === 'BLOCK');
              const newWallets = [
                ...wallets.slice(0, idx),
                Object.assign({}, wallets[idx], {
                  username: value.trim()
                }),
                ...wallets.slice(idx + 1)
              ];
              state.set('wallets', newWallets);
            });
          $('#js-rpcPassword')
            .off('change')
            .on('change', e => {
              const wallets = state.get('wallets');
              const { value } = e.target;
              const idx = wallets.findIndex(w => w.abbr === 'BLOCK');
              const newWallets = [
                ...wallets.slice(0, idx),
                Object.assign({}, wallets[idx], {
                  password: value
                }),
                ...wallets.slice(idx + 1)
              ];
              state.set('wallets', newWallets);
            });

          $('.js-versionDropdownButton')
            .off('click')
            .on('click', e => {
              e.preventDefault();

              const closeDropdowns = callback => {
                const $target = $('#js-mainConfigurationArea');
                const $icons = $target.find('i.fa-angle-up');
                $target.find('.js-dropdownMenu').remove();
                $icons
                  .addClass('fa-angle-down')
                  .removeClass('fa-angle-up');
                if(callback) setTimeout(callback, 0);
              };

              $('#js-mainConfigurationArea')
                .off('click')
                .on('click', e => {
                  const $target = $(e.target);
                  if(!$target.hasClass('js-versionDropdownButton') && !$target.parent().hasClass('js-versionDropdownButton')) {
                    closeDropdowns();
                  }

                  // console.log('Clicked!', e.target);
                  // const $icons = $(e.currentTarget).find('i.fa-angle-up');
                  // $(e.currentTarget).find('.js-dropdownMenu').remove();
                  // $icons
                  //   .addClass('fa-angle-down')
                  //   .removeClass('fa-angle-up');

                });

              const $target = $(e.currentTarget);
              const abbr = $target.attr('data-abbr');
              const wallets = state.get('wallets');
              const idx = wallets.findIndex(w => w.abbr === abbr);
              const wallet = wallets[idx];
              const $icon = $target.find('i');
              if($icon.hasClass('fa-angle-down')) { // dropdown currently closed

                const height = $target.outerHeight();
                const width = $target.outerWidth();

                closeDropdowns(() => {

                  $icon.addClass('fa-angle-up');
                  $icon.removeClass('fa-angle-down');

                  $target.append(`
                    <div class="js-dropdownMenu" style="z-index:1000;position:absolute;top:${height}px;left:0;background-color:#ddd;width:${width}px;max-height:162px;overflow-y:auto;">
                      ${sortByVersion(wallet.versions).reverse().map(v => `<div class="js-dropdownMenuItem dropdown-button" data-version="${v}"><div>${v}</div></div>`).join('')}
                    </div>
                  `);

                  setTimeout(() => {
                    $('.js-dropdownMenuItem')
                      .off('click')
                      .on('click', e => {
                        e.preventDefault();
                        const v = $(e.currentTarget).attr('data-version');
                        state.set('wallets', [
                          ...wallets.slice(0, idx),
                          Object.assign({}, wallet, {
                            version: v
                          }),
                          ...wallets.slice(idx + 1)
                        ]);
                        $($target.find('div')[0]).text(v);
                      });
                  }, 0);
                });

              } else { // dropdown currently open
                closeDropdowns();
              }
          });

        }, 0);
      };

      const renderSidebar = () => {
        const selected = state.get('sidebarSelected');
        const html = state.get('sidebarItems')
          .map((item, idx) => {
            const { text = '', checked = false } = item;
            return `<div class="sidebar-item js-sidebarItem" data-sidebar-index="${idx}" ><i class="${selected >= idx ? 'fa fa-circle' : 'far fa-circle'} radio-icon"></i> ${text}</div>`;
          })
          .join('\n');
        return html;
      };

      const renderConfiguration1 = () => {
        const selected = state.get('selectedWallets');
        const items = state.get('wallets');
        const skip = state.get('skipSetup');
        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:10px;">In order to conduct peer-to-peer trades, Block DX requires RPC access to the wallets of each coin that will be traded. Select the coins of the wallets that are installed.</p>
          <div id="js-mainConfigurationArea" class="main-area" style="position:relative;${skip ? 'opacity:.6;overflow-y:hidden;' : 'opacity:1;overflow-y:scroll;'}">
            ${items
              .map(i => {
                if(i.abbr === 'BLOCK') {
                  return `<div class="main-area-item" style="cursor:default;opacity:1;"><i class="far ${selected.has(i.abbr) ? 'fa-check-square' : 'fa-square'} radio-icon"></i> ${i.name} (${i.abbr})</div>`
                } else {
                  return `<div class="js-mainAreaItem main-area-item" data-abbr="${i.abbr}"><i class="far ${selected.has(i.abbr) ? 'fa-check-square' : 'fa-square'} radio-icon"></i> ${i.name} (${i.abbr})</div>`
                }
              })
              .join('\n')
            }
            <div id="js-overlay" style="display:${skip ? 'block' : 'none'};position:absolute;left:0;top:0;width:100%;height:100%;background-color:#000;opacity:0;"></div>
          </div>
          <div style="padding: 10px; cursor: pointer;padding-bottom:0;">
            <div id="js-skip" class="main-area-item"><i class="far ${skip ? 'fa-check-square' : 'fa-square'} radio-icon"></i> Skip and setup Block DX manually (not recommended)</div>
          </div>

          <div id="js-buttonContainer" class="button-container">
            <button style="visibility:hidden;" id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-continueBtn" type="button">CONTINUE</button>
          </div>
          `;
        return html;
      };

      const renderConfiguration2 = ({ wallets }) => {
        const items = wallets
          .map(w => {
            return `
              <div class="main-area-item2">
                <div style="display:flex;flex-direction:row:flex-wrap:nowrap;justify-content:space-between;">
                  <div>${w.name}</div>
                  <div id="${w.abbr}-error" class="text-danger" style="display:${w.error || !w.directory ? 'block' : 'none'};text-align:right;">Error: data directory not found</div>
                </div>
                <div style="margin-top:10px;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;">
                  <input id="${w.abbr}" type="text" value="${w.directory}" readonly />
                  <button class="js-browseBtn" type="button" data-abbr="${w.abbr}" style="margin-top:0;margin-right:0;width:100px;min-width:100px;">BROWSE</button>
                </div>
              </div>
              <div style="height:1px;"></div>
            `;
          })
          .join('\n');
        const missingDirectories = wallets
          .reduce((num, w) => {
            return (!w.error && w.directory) ? num : num + 1;
          }, 0);

        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">Please review the locations of each wallet's data directory.</p>
          <p id="js-errors" class="text-danger" style="display:${missingDirectories > 0 ? 'block' : 'none'};margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:10px;"><span id="js-errorCount">${missingDirectories}</span> error(s) exist; continue to skip wallets with errors.</p>
          <div id="js-mainConfigurationArea" class="main-area">
            ${items}
          </div>
          <div id="js-buttonContainer" class="button-container">
            <button id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-continueBtn" type="button">CONTINUE</button>
          </div>
        `;
        return html;
      };

      const renderConfiguration3 = ({ wallets }) => {

        const items = wallets
          .map(w => {
            return `
              <div class="main-area-item2">
                <div style="display:flex;flex-direction:row:flex-wrap:nowrap;justify-content:space-between;">
                  <div>${w.name}</div>
                  <!--<div id="${w.abbr}-error" class="text-danger" style="display:${w.error || !w.directory ? 'block' : 'none'};text-align:right;">Error: data directory not found</div>-->
                </div>
                <div class="input-group" style="margin-bottom:0;margin-top:10px;">
                  <label style="flex-basis:0;flex-grow:1;">Wallet Version</label>
                  <div class="js-versionDropdownButton dropdown-button" data-abbr="${w.abbr}" style="flex-basis:0;flex-grow:1;">
                    <div style="margin-left:10px;">${w.version}</div>
                    <div><i class="fas fa-angle-down radio-icon" style="margin-right:0;font-size:20px;"></i></div>
                  </div>
                </div>
              </div>
              <div style="height:1px;"></div>
            `;
          })
          .join('\n');
        const missingDirectories = wallets
          .reduce((num, w) => {
            return (!w.error && w.directory) ? num : num + 1;
          }, 0);

        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:10px;">Please select the version of the wallet installed for each of the following coins.</p>
          <!--<p id="js-errors" class="text-danger" style="display:${missingDirectories > 0 ? 'block' : 'none'};margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:10px;"><span id="js-errorCount">${missingDirectories}</span> error(s) exist; continue to skip wallets with errors.</p>-->
          <div id="js-mainConfigurationArea" class="main-area">
            ${items}
          </div>
          <div id="js-buttonContainer" class="button-container">
            <button id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-continueBtn" type="button">CONTINUE</button>
          </div>
        `;
        return html;
      };

      const renderSettings1 = () => {
        const generateCredentials = state.get('generateCredentials');
        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">Usernames and passwords must be created for the wallets of each of the coins that will be traded.</p>
          <div class="main-area" style="background-color:#0e2742;overflow-y:auto;">
            <div id="js-automaticCredentials" class="main-area-item"><i class="${generateCredentials ? 'fa' : 'far'} fa-circle radio-icon"></i> Automatically generate credentials</div>
            <div id="js-manualCredentials" class="main-area-item"><i class="${!generateCredentials ? 'fa' : 'far'} fa-circle radio-icon"></i> Create RPC credentials manually (not recommended)</div>
          </div>
          <div id="js-buttonContainer" class="button-container">
            <button id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-continueBtn" type="button">CONTINUE</button>
          </div>
        `;
        return html;
      };

      const renderSettings2 = ({ wallets }) => {
        const items = wallets
          .map(w => {
            return `
              <div class="main-area-item2">
                <div style="display:flex;flex-direction:row:flex-wrap:nowrap;justify-content:space-between;">
                  <div>${w.name}</div>
                  <div id="${w.abbr}-error" class="text-danger" style="display:none;text-align:right;">Error: data directory not found</div>
                </div>
                <div style="margin-top:10px;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;">
                  <input class="js-usernameInput" data-abbr="${w.abbr}" type="text" style="margin-right:10px;" value="${w.username}" placeholder="RPC username" />
                  <input class="js-passwordInput" data-abbr="${w.abbr}" type="text" value="${w.password}" placeholder="RPC password" />
                  <!--<button class="js-saveBtn" type="button" data-abbr="${w.abbr}" style="margin-top:0;margin-right:0;width:100px;min-width:100px;">SAVE</button>-->
                </div>
              </div>
              <div style="height:1px;"></div>
            `;
          })
          .join('\n');

        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">Please set the RPC username and password for each wallet.</p>
          <div id="js-mainConfigurationArea" class="main-area">
            ${items}
          </div>
          <div id="js-buttonContainer" class="button-container">
            <button id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-continueBtn" type="button">CONTINUE</button>
          </div>
        `;
        return html;
      };

      const renderSettings3 = () => {
        const wallets = state.get('wallets');
        const block = wallets.find(w => w.abbr === 'BLOCK');
        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">In order to conduct peer-to-peer trades, BLOCK DX requires RPC acces to the Blocknet blockchain. BLOCK DX requires Blocknet wallet version 3.9.04 or greater.</p>
          <div class="main-area" style="background-color:#0e2742;overflow-y:auto;">
            <div class="input-group">
              <label>Blocknet RPC Port</label>
              <input id="js-rpcPort" type="text" value="${state.get('rpcPort')}" />
            </div>
            <div class="input-group">
              <label>Blocknet RPC User</label>
              <input id="js-rpcUser" type="text" value="${block.username}" />
            </div>
            <div class="input-group">
              <label>Blocknet RPC Password</label>
              <input id="js-rpcPassword" type="text" value="${block.password}" />
            </div>
          </div>
          <div id="js-buttonContainer" class="button-container">
            <button id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-continueBtn" type="button">CONTINUE</button>
          </div>
        `;
        return html;
      };

      const renderComplete = () => {
        const html = `
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">Please follow these last few steps to use Block DX:</p>
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">- Open and unlock the wallets of any coins to be traded</p>
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">- Restart and unlock the Blocknet wallet</p>
          <p style="margin-top:0;padding-top:0;padding-left:10px;padding-right:10px;margin-bottom:5px;">- Select 'Finish' to restart Block DX and begin trading</p>
          <div class="main-area" style="background-color:#0e2742;overflow-y:auto;"></div>
          <div id="js-buttonContainer" class="button-container">
            <button id="js-backBtn" type="button" class="gray-button">BACK</button>
            <button id="js-finish" type="button">FINISH</button>
          </div>
        `;
        return html;
      };

      render();

    });

  </script>

</body>
</html>
